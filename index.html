<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Birds by Selim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


  <style>
    /* --- FIX HAMBURGER ICON ON MOBILE --- */
    .navbar-toggler {
      border-color: rgba(0, 0, 0, 0.2);
    }

    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,0.7)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
    }

    /* Fullscreen minimal lightbox */
    #lightboxOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.93);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
      z-index: 2000;
      cursor: zoom-out;

      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease;
      /* FADE EFFECT */
    }

    #lightboxOverlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Image fade-in */
    #lightboxImage {
      max-width: 100%;
      max-height: 90vh;
      object-fit: contain;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
      opacity: 0;
      transition: opacity 0.35s ease 0.05s;
      border-radius: 0;
      /* ‚Üê remove curves */
    }

    #lightboxOverlay.show #lightboxImage {
      opacity: 1;
    }

    #lightboxCaption {
      margin-top: 12px;
      color: #ffffff;
      font-size: 16px;
      text-align: center;
      opacity: 0;
      transition: opacity 0.35s ease 0.1s;
    }

    #lightboxOverlay.show #lightboxCaption {
      opacity: 1;
    }

    /* bottom-right attribution for audio credit */
    #lightboxAttribution {
      position: absolute;
      right: 20px;
      bottom: 20px;
      color: #ffffff;
      font-size: 12px;
      opacity: 0.8;
    }


    /* Filter panel: hidden by default, fades in when opened */
    #filterPanel {
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      pointer-events: none;
      transition: opacity 0.5s ease, max-height 0.5s ease;
    }

    #filterPanel.open {
      opacity: 1;
      max-height: 80px;
      /* adjust if you add more filters */
      pointer-events: auto;
    }


    /* ----------------------------- 
       BASE LIGHT THEME
    ------------------------------*/
    body {
      background-color: #f8f9fa;
      color: #111;
      transition: background 0.3s, color 0.3s;
    }

    .gallery-img {
      width: 100%;
      cursor: pointer;
      display: block;
      transition: opacity 0.2s ease;
    }

    .gallery-img:hover {
      opacity: 0.9;
    }

    .bird-caption {
      font-weight: 600;
      margin-top: 0.5rem;
    }

    /* .bird-desc {
      color: #666;
      font-size: 0.9rem;
    } */

    .photo-box {
      background: transparent;
      border: none;
      box-shadow: none;
    }

    .photo-box img {
      transition: transform 0.25s ease;
    }

    .photo-box:hover img {
      transform: scale(1.03);
    }


    .highlight-bird {
      outline: 3px solid #0d6efd;
      outline-offset: 3px;
    }

    /* ----------------------------- 
       DARK MODE OVERRIDES
    ------------------------------*/
    .dark-mode {
      background-color: #121212 !important;
      color: #e8e8e8 !important;
    }

    .dark-mode .navbar {
      background-color: #1e1e1e !important;
      border-color: #333 !important;
    }

    .dark-mode .navbar-brand {
      color: #eaeaea !important;
    }

    .dark-mode .nav-link {
      color: #e0e0e0 !important;
    }

    .dark-mode .lead,
    .dark-mode p {
      color: #e5e5e5 !important;
    }

    .dark-mode h1 {
      color: #ffffff !important;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.15);
    }

    .dark-mode .text-muted {
      color: #cccccc !important;
    }

    /* .dark-mode .bird-desc {
      color: #aaa;
    } */

    .dark-mode .gallery-img {
      filter: brightness(0.9);
    }

    /* Light/dark toggle button */
    .theme-toggle-btn {
      border: 1px solid #bbb;
      border-radius: 5px;
      padding: 4px 10px;
      cursor: pointer;
      background: transparent;
      transition: background 0.3s;
    }

    .theme-toggle-btn:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    .dark-mode .theme-toggle-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Glass scroll-to-top button */
    .scroll-top-btn {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      backdrop-filter: blur(8px);
      background: rgba(255, 255, 255, 0.28);
      /* translucent glass */
      color: #ffffff;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;

      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.25s ease, background 0.2s ease;

      /* soft shadow like your screenshot */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
      z-index: 999;
    }

    .scroll-top-btn:hover {
      background: rgba(255, 255, 255, 0.38);
      transform: scale(1.08);
    }

    /* Dark mode version (glass but darker) */
    .dark-mode .scroll-top-btn {
      background: rgba(30, 30, 30, 0.35);
      color: #fff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
    }

    .dark-mode .scroll-top-btn:hover {
      background: rgba(30, 30, 30, 0.45);
    }


    /* --- ARTSY FLOATING BLOBS BACKGROUND --- */
    .background-blobs {
      position: fixed;
      inset: 0;
      z-index: -1;
      /* behind everything */
      overflow: hidden;
      pointer-events: none;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.35;
      animation: blobMove 18s ease-in-out infinite alternate;
    }

    /* Blob colours */
    .blob1 {
      width: 350px;
      height: 350px;
      background: #6ec3ff;
      /* soft blue */
      top: 5%;
      left: 10%;
    }

    .blob2 {
      width: 300px;
      height: 300px;
      background: #ff8ab8;
      /* soft pink */
      top: 40%;
      right: 5%;
      animation-delay: -6s;
    }

    .blob3 {
      width: 420px;
      height: 420px;
      background: #baffc9;
      /* mint green */
      bottom: -10%;
      left: 30%;
      animation-delay: -12s;
    }

    /* Blob movement animation */
    @keyframes blobMove {
      0% {
        transform: translate(0, 0) scale(1);
      }

      50% {
        transform: translate(40px, -30px) scale(1.15);
      }

      100% {
        transform: translate(-20px, 20px) scale(0.95);
      }
    }

    /* Dark mode adjustment */
    .dark-mode .blob {
      opacity: 0.2;
      filter: blur(80px);
    }
  </style>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-N7NXSDJGF6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-N7NXSDJGF6');
  </script>

</head>

<body>


  <div id="lightboxOverlay">
    <img id="lightboxImage" src="" alt="">
    <div id="lightboxCaption"></div>
    <div id="lightboxAttribution"></div>
  </div>


  <div class="background-blobs">
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>
  </div>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
    <div class="container">

      <a class="navbar-brand" href="index.html">Birds by Selim</a>

      <!-- DARK MODE BUTTON ‚Äî ALWAYS VISIBLE -->
      <button class="theme-toggle-btn d-lg-none ms-auto me-2" onclick="toggleTheme()">
        üåô / ‚òÄÔ∏è
      </button>

      <!-- MOBILE MENU BUTTON -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- COLLAPSIBLE NAV LINKS -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Gallery</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="map.html">Map</a>
          </li>
        </ul>

        <!-- DESKTOP VERSION OF THE BUTTON -->
        <button class="theme-toggle-btn d-none d-lg-inline-block ms-3" onclick="toggleTheme()">
          üåô / ‚òÄÔ∏è
        </button>
      </div>

    </div>
  </nav>



  <!-- INTRO -->
  <section class="py-5 text-center container">
    <h1 class="fw-light">Birds by Selim</h1>
    <p class="lead text-muted">A simple collection of birds.</p>

    <!-- Controls -->
    <div class="row justify-content-center mt-4">
      <div class="col-md-6">
        <div class="input-group">
          <input id="searchInput" type="text" class="form-control" placeholder="Search by bird name...">

          <!-- FILTER TOGGLE BUTTON -->
          <button id="filterToggleBtn" class="btn btn-outline-secondary" type="button">
            Filters ‚ñæ
          </button>

          <button id="randomBtn" class="btn btn-outline-secondary" type="button">
            üé≤ Random bird
          </button>
        </div>

        <!-- FILTER PANEL (hidden by default) -->
        <div id="filterPanel" class="text-start mt-2">
          <small class="text-muted me-2">Filter by location:</small>

          <div class="form-check form-check-inline">
            <input class="form-check-input location-checkbox" type="checkbox" id="locTas" value="tasmania">
            <label class="form-check-label" for="locTas">Tasmania</label>
          </div>

          <div class="form-check form-check-inline">
            <input class="form-check-input location-checkbox" type="checkbox" id="locVic" value="victoria">
            <label class="form-check-label" for="locVic">Victoria</label>
          </div>
        </div>

        <small class="text-muted d-block mt-2">
          Showing <span id="visibleCount">0</span> of <span id="totalCount">0</span> birds
        </small>
      </div>
    </div>

  </section>

  <!-- GALLERY -->
  <div class="container pb-5">
    <div id="galleryRow" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      <!-- cards will be injected here from birds.json -->
    </div>
  </div>



  <button id="scrollTopBtn" class="scroll-top-btn">‚Üë</button>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>

    let currentAudio = null;

    // -------- DARK MODE  --------
    function toggleTheme() {
      const body = document.body;
      body.classList.toggle("dark-mode");
      if (body.classList.contains("dark-mode")) {
        localStorage.setItem("theme", "dark");
      } else {
        localStorage.setItem("theme", "light");
      }
    }

    // We'll load data first, THEN init everything else
    window.onload = () => {
      const saved = localStorage.getItem("theme");
      if (saved === "dark") {
        document.body.classList.add("dark-mode");
      }

      // After theme, load bird data and initialise page
      fetch('data/bird_data.json')
        .then(res => res.json())
        .then(birds => initGalleryPage(birds))
        .catch(err => console.error('Error loading bird_data.json', err));
    };

    function initGalleryPage(birds) {
      const galleryRow = document.getElementById('galleryRow');

      galleryRow.innerHTML = birds.map(bird => {
        const audio = bird.audio || {};
        const audioSrc = audio.src || "";
        const audioCredit = audio.credit || "";

        return `
          <div class="col">
            <div class="photo-box">
              <img src="${bird.src}"
                  class="gallery-img"
                  data-title="${bird.title}"
                  data-location="${bird.region}"
                  data-place="${bird.place}"
                  data-audio="${audioSrc}"
                  data-audio-credit="${audioCredit}">
              <div class="bird-caption">${bird.title}</div>
            </div>
          </div>
        `;
      }).join('');

      const totalCountEl = document.getElementById('totalCount');
      if (totalCountEl) totalCountEl.textContent = birds.length;

      setupLightbox();
      setupSearchFilterRandom();
      setupScrollTop();
    }

    // -------- MINIMAL LIGHTBOX (NO BOX, NO ARROWS) --------
    function setupLightbox() {
      const thumbs = Array.from(document.querySelectorAll('.gallery-img'));
      const overlay = document.getElementById('lightboxOverlay');
      const overlayImg = document.getElementById('lightboxImage');
      const overlayCaption = document.getElementById('lightboxCaption');
      const overlayAttrib = document.getElementById('lightboxAttribution');

      function openLightbox(imgEl) {
        // image + title
        overlayImg.src = imgEl.getAttribute('src');
        overlayCaption.textContent = imgEl.dataset.title || '';
        overlay.classList.add('show');

        // stop any previous audio
        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
        }

        // audio + attribution
        const audioSrc = imgEl.dataset.audio;
        const audioCredit = imgEl.dataset.audioCredit || '';

        overlayAttrib.textContent = audioCredit;

        if (audioSrc) {
          currentAudio = new Audio(audioSrc);
          currentAudio.play().catch(err => {
            console.warn('Audio autoplay was blocked:', err);
          });
        }
      }

      function closeLightbox() {
        overlay.classList.remove('show');
        overlayImg.src = '';
        overlayCaption.textContent = '';
        overlayAttrib.textContent = '';

        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
        }
      }

      thumbs.forEach(img => {
        img.addEventListener('click', () => openLightbox(img));
      });

      overlay.addEventListener('click', closeLightbox);

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && overlay.classList.contains('show')) {
          closeLightbox();
        }
      });
    }


    // -------- SEARCH / FILTER + RANDOM BIRD --------
    function setupSearchFilterRandom() {
      const searchInput = document.getElementById('searchInput');
      const randomBtn = document.getElementById('randomBtn');
      const visibleCountEl = document.getElementById('visibleCount');
      const cols = Array.from(document.querySelectorAll('#galleryRow .col'));

      const filterToggleBtn = document.getElementById('filterToggleBtn');
      const filterPanel = document.getElementById('filterPanel');
      const locationCheckboxes = Array.from(document.querySelectorAll('.location-checkbox'));

      if (filterToggleBtn && filterPanel) {
        filterToggleBtn.addEventListener('click', () => {
          filterPanel.classList.toggle('open');
        });
      }

      function updateVisibleCount() {
        if (!visibleCountEl) return;
        const visible = cols.filter(col => col.style.display !== 'none').length;
        visibleCountEl.textContent = visible;
      }

      function filterBirds() {
        const q = (searchInput?.value || '').toLowerCase().trim();

        const activeLocations = locationCheckboxes
          .filter(cb => cb.checked)
          .map(cb => cb.value);

        cols.forEach(col => {
          const captionEl = col.querySelector('.bird-caption');
          const name = captionEl ? captionEl.textContent.toLowerCase() : '';
          const imgEl = col.querySelector('.gallery-img');

          const locAttr = (imgEl?.dataset.location || '').toLowerCase();
          const imgLocations = locAttr.split(',').map(x => x.trim()).filter(Boolean);

          const matchesText = name.includes(q);

          let matchesLocation = true;
          if (activeLocations.length > 0) {
            matchesLocation = imgLocations.some(l => activeLocations.includes(l));
          }

          col.style.display = (matchesText && matchesLocation) ? '' : 'none';
        });

        updateVisibleCount();
      }

      if (searchInput) {
        searchInput.addEventListener('input', filterBirds);
      }
      locationCheckboxes.forEach(cb => cb.addEventListener('change', filterBirds));

      function clearHighlights() {
        document.querySelectorAll('.highlight-bird').forEach(el => {
          el.classList.remove('highlight-bird');
        });
      }

      function jumpToRandomBird() {
        const visibleCols = cols.filter(col => col.style.display !== 'none');
        if (visibleCols.length === 0) return;

        const randomIndex = Math.floor(Math.random() * visibleCols.length);
        const chosenCol = visibleCols[randomIndex];

        clearHighlights();
        chosenCol.classList.add('highlight-bird');
        chosenCol.scrollIntoView({ behavior: 'smooth', block: 'center' });

        setTimeout(() => {
          chosenCol.classList.remove('highlight-bird');
        }, 1200);
      }

      if (randomBtn) {
        randomBtn.addEventListener('click', jumpToRandomBird);
      }

      // initialise count once
      updateVisibleCount();
    }

    // -------- SCROLL TO TOP BUTTON --------
    function setupScrollTop() {
      const scrollTopBtn = document.getElementById("scrollTopBtn");
      if (!scrollTopBtn) return;

      window.addEventListener("scroll", () => {
        if (window.scrollY > 250) {
          scrollTopBtn.style.opacity = "1";
          scrollTopBtn.style.pointerEvents = "auto";
        } else {
          scrollTopBtn.style.opacity = "0";
          scrollTopBtn.style.pointerEvents = "none";
        }
      });

      scrollTopBtn.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
  </script>



</body>

</html>